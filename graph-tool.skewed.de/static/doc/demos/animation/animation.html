
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Animations with graph-tool &#8212; graph-tool 2.27 documentation</title>
    <link rel="stylesheet" href="../../_static/gt_style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/MathJax/MathJax.js?config=default"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within graph-tool 2.27 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/graph-icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Module documentation" href="http://graph-tool.skewed.de/static/doc/modules.html" />
    <link rel="prev" title="Inferring modular network structure" href="../inference/inference.html" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl =
        '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-248813-2']);
      _gaq.push(['_setDomainName', '.skewed.de']);
      _gaq.push(['_trackPageview']);
      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
     

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="http://graph-tool.skewed.de/static/doc/modules.html" title="Module documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../inference/inference.html" title="Inferring modular network structure"
             accesskey="P">previous</a> |</li>
    <li><img src="../../../../img/graph-icon.png" alt="logo" style="margin-right: 5px; margin-bottom:-2px;" /><a href="../../../../index.html">Project Homepage</a> &raquo;</li>
    
        <li class="nav-item nav-item-0"><a href="../../index.html">graph-tool 2.27 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Cookbook</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="animations-with-graph-tool">
<h1>Animations with graph-tool<a class="headerlink" href="animation.html#animations-with-graph-tool" title="Permalink to this headline">¶</a></h1>
<p>The drawing capabilities of <code class="docutils literal notranslate"><span class="pre">graph-tool</span></code> (see <a class="reference internal" href="../../draw.html#module-graph_tool.draw" title="graph_tool.draw"><code class="xref py py-mod docutils literal notranslate"><span class="pre">draw</span></code></a>
module) can be harnessed to perform animations in a straightforward
manner. Here we show some examples which uses <a class="reference external" href="http://www.gtk.org/">GTK+</a> to display animations in an
<a class="reference internal" href="../../draw.html#graph_tool.draw.interactive_window" title="graph_tool.draw.interactive_window"><code class="xref py py-class docutils literal notranslate"><span class="pre">interactive_window</span></code></a>, as well as offscreen to a
file. The idea is to easily generate visualisations which can be used in
presentations, and embedded in websites.</p>
<div class="section" id="sirs-epidemics">
<h2>SIRS epidemics<a class="headerlink" href="animation.html#sirs-epidemics" title="Permalink to this headline">¶</a></h2>
<p>Here we implement a simple <a class="reference external" href="http://en.wikipedia.org/wiki/Epidemic_model">SIRS epidemics</a> on a network, and we
construct an animation showing the time evolution. Nodes which are
susceptible (S) are shown in white, whereas infected (I) nodes are shown
in black. Recovered (R) nodes are removed from the layout, since they
cannot propagate the outbreak.</p>
<p>The script which performs the animation is called
<a class="reference download internal" href="http://graph-tool.skewed.de/static/doc/_downloads/animation_sirs.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">animation_sirs.py</span></code></a> and is shown below.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This simple example on how to do animations using graph-tool. Here we do a</span>
<span class="c1"># simple simulation of an S-&gt;I-&gt;R-&gt;S epidemic model, where each vertex can be in</span>
<span class="c1"># one of the following states: Susceptible (S), infected (I), recovered (R). A</span>
<span class="c1"># vertex in the S state becomes infected either spontaneously with a probability</span>
<span class="c1"># &#39;x&#39; or because a neighbor is infected. An infected node becomes recovered</span>
<span class="c1"># with probability &#39;r&#39;, and a recovered vertex becomes again susceptible with</span>
<span class="c1"># probability &#39;s&#39;.</span>

<span class="c1"># DISCLAIMER: The following code is definitely not the most efficient approach</span>
<span class="c1"># if you want to simulate this dynamics for very large networks, and/or for very</span>
<span class="c1"># long times. The main purpose is simply to highlight the animation capabilities</span>
<span class="c1"># of graph-tool.</span>

<span class="kn">from</span> <span class="nn">graph_tool.all</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>

<span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">seed_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># We need some Gtk and gobject functions</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="k">import</span> <span class="n">Gtk</span><span class="p">,</span> <span class="n">Gdk</span><span class="p">,</span> <span class="n">GdkPixbuf</span><span class="p">,</span> <span class="n">GObject</span>

<span class="c1"># We will use the network of network scientists, and filter out the largest</span>
<span class="c1"># component</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;netscience&quot;</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">GraphView</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vfilt</span><span class="o">=</span><span class="n">label_largest_component</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>  <span class="c1"># layout positions</span>

<span class="c1"># We will filter out vertices which are in the &quot;Recovered&quot; state, by masking</span>
<span class="c1"># them using a property map.</span>
<span class="n">removed</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

<span class="c1"># SIRS dynamics parameters:</span>

<span class="n">x</span> <span class="o">=</span> <span class="mf">0.001</span>    <span class="c1"># spontaneous outbreak probability</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.1</span>      <span class="c1"># I-&gt;R probability</span>
<span class="n">s</span> <span class="o">=</span> <span class="mf">0.01</span>     <span class="c1"># R-&gt;S probability</span>

<span class="c1"># (Note that the S-&gt;I transition happens simultaneously for every vertex with a</span>
<span class="c1">#  probability equal to the fraction of non-recovered neighbors which are</span>
<span class="c1">#  infected.)</span>

<span class="c1"># The states would usually be represented with simple integers, but here we will</span>
<span class="c1"># use directly the color of the vertices in (R,G,B,A) format.</span>

<span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>           <span class="c1"># White color</span>
<span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>           <span class="c1"># Black color</span>
<span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>    <span class="c1"># Grey color (will not actually be drawn)</span>

<span class="c1"># Initialize all vertices to the S state</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="s2">&quot;vector&lt;double&gt;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">():</span>
    <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>

<span class="c1"># Newly infected nodes will be highlighted in red</span>
<span class="n">newly_infected</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

<span class="c1"># If True, the frames will be dumped to disk as images.</span>
<span class="n">offscreen</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;offscreen&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<span class="n">max_count</span> <span class="o">=</span> <span class="mi">500</span>
<span class="k">if</span> <span class="n">offscreen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;./frames&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./frames&quot;</span><span class="p">)</span>

<span class="c1"># This creates a GTK+ window with the initial graph layout</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">offscreen</span><span class="p">:</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">GraphWindow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
                      <span class="n">edge_color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">vertex_fill_color</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
                      <span class="n">vertex_halo</span><span class="o">=</span><span class="n">newly_infected</span><span class="p">,</span>
                      <span class="n">vertex_halo_color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">OffscreenWindow</span><span class="p">()</span>
    <span class="n">win</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">GraphWidget</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
                            <span class="n">edge_color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">vertex_fill_color</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
                            <span class="n">vertex_halo</span><span class="o">=</span><span class="n">newly_infected</span><span class="p">,</span>
                            <span class="n">vertex_halo_color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
    <span class="n">win</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>


<span class="c1"># This function will be called repeatedly by the GTK+ main loop, and we use it</span>
<span class="c1"># to update the state according to the SIRS dynamics.</span>
<span class="k">def</span> <span class="nf">update_state</span><span class="p">():</span>
    <span class="n">newly_infected</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">removed</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># visit the nodes in random order</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">())</span>
    <span class="n">shuffle</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">I</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">S</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">out_neighbors</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">ns</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">))]</span>  <span class="c1"># choose a random neighbor</span>
                    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">==</span> <span class="n">I</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
                        <span class="n">newly_infected</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">R</span><span class="p">:</span>
            <span class="n">removed</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Filter out the recovered vertices</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_vertex_filter</span><span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># The following will force the re-drawing of the graph, and issue a</span>
    <span class="c1"># re-drawing of the GTK window.</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">regenerate_surface</span><span class="p">()</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">queue_draw</span><span class="p">()</span>

    <span class="c1"># if doing an offscreen animation, dump frame to disk</span>
    <span class="k">if</span> <span class="n">offscreen</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">count</span>
        <span class="n">pixbuf</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">get_pixbuf</span><span class="p">()</span>
        <span class="n">pixbuf</span><span class="o">.</span><span class="n">savev</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;./frames/sirs</span><span class="si">%06d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># We need to return True so that the main loop will call this function more</span>
    <span class="c1"># than once.</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="c1"># Bind the function above as an &#39;idle&#39; callback.</span>
<span class="n">cid</span> <span class="o">=</span> <span class="n">GObject</span><span class="o">.</span><span class="n">idle_add</span><span class="p">(</span><span class="n">update_state</span><span class="p">)</span>

<span class="c1"># We will give the user the ability to stop the program by closing the window.</span>
<span class="n">win</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;delete_event&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">)</span>

<span class="c1"># Actually show the window, and start the main loop.</span>
<span class="n">win</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>
<span class="n">Gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>If called without arguments, the script will show the animation inside an
<a class="reference internal" href="../../draw.html#graph_tool.draw.interactive_window" title="graph_tool.draw.interactive_window"><code class="xref py py-class docutils literal notranslate"><span class="pre">interactive_window</span></code></a>. If the parameter
<code class="docutils literal notranslate"><span class="pre">offscreen</span></code> is passed, individual frames will be saved in the
<code class="docutils literal notranslate"><span class="pre">frames</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./animation_sirs.py offscreen
</pre></div>
</div>
<p>These frames can be combined and encoded into the appropriate
format. Here we use the <a class="reference external" href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html">mencoder</a> tool from
<a class="reference external" href="http://www.mplayerhq.hu">mplayer</a> to combine all the frames into a
single file with YUY format, and then we encode this with the <a class="reference external" href="http://www.webmproject.org">WebM
format</a>, using <a class="reference external" href="http://www.webmproject.org/docs/encoder-parameters/">vpxenc</a>, so that it can
be embedded in a website.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mencoder mf://frames/sirs*.png -mf <span class="nv">w</span><span class="o">=</span><span class="m">500</span>:h<span class="o">=</span><span class="m">400</span>:type<span class="o">=</span>png -ovc raw -of rawvideo -vf <span class="nv">format</span><span class="o">=</span>i420 -nosound -o sirs.yuy
$ vpxenc sirs.yuy -o sirs.webm -w <span class="m">500</span> -h <span class="m">400</span> --fps<span class="o">=</span><span class="m">25</span>/1 --target-bitrate<span class="o">=</span><span class="m">1000</span> --good --threads<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>The resulting animation can be downloaded <a class="reference download internal" href="../../_downloads/sirs.webm" download=""><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>,
or played below if your browser supports WebM.</p>
<div style="text-align:center">
    <video id="sirs" src="../../_downloads/sirs.webm" controls></video>
</div><p>This type of animation can be extended or customized in many ways, by
dynamically modifying the various drawing parameters and vertex/edge
properties. For instance, one might want to represent the susceptible
state as either <a class="reference internal" href="../../_images/face-grin.png"><img alt="susceptible" src="../../_images/face-grin.png" style="width: 48px; height: 48px;" /></a> or <a class="reference internal" href="../../_images/face-surprise.png"><img alt="susceptible-fear" src="../../_images/face-surprise.png" style="width: 48px; height: 48px;" /></a>, depending on
whether a neighbor is infected, and the infected state as <a class="reference internal" href="../../_images/zombie.png"><img alt="zombie" src="../../_images/zombie.png" style="width: 48px; height: 48px;" /></a>.
Properly modifying the script above would lead to the following
<a class="reference download internal" href="../../_downloads/zombie.webm" download=""><code class="xref download docutils literal notranslate"><span class="pre">movie</span></code></a>:</p>
<div style="text-align:center">
    <video id="sirs" src="../../_downloads/zombie.webm" controls></video>
</div><p>The modified script can be downloaded <a class="reference download internal" href="http://graph-tool.skewed.de/static/doc/_downloads/animation_zombies.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
</div>
<div class="section" id="dynamic-layout">
<h2>Dynamic layout<a class="headerlink" href="animation.html#dynamic-layout" title="Permalink to this headline">¶</a></h2>
<p>The graph layout can also be updated during an animation. As an
illustration, here we consider a very simplistic model for spatial
segregation, where the edges of the graph are repeatedly and randomly
rewired, as long as the new edge has a shorter euclidean distance.</p>
<p>The script which performs the animation is called
<a class="reference download internal" href="http://graph-tool.skewed.de/static/doc/_downloads/animation_dancing.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">animation_dancing.py</span></code></a> and is shown below.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This simple example on how to do animations using graph-tool, where the layout</span>
<span class="c1"># changes dynamically. We start with some network, and randomly rewire its</span>
<span class="c1"># edges, and update the layout dynamically, where edges are rewired only if</span>
<span class="c1"># their euclidean distance is reduced. It is thus a very simplistic model for</span>
<span class="c1"># spatial segregation.</span>

<span class="kn">from</span> <span class="nn">graph_tool.all</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>

<span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">seed_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># We need some Gtk and gobject functions</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="k">import</span> <span class="n">Gtk</span><span class="p">,</span> <span class="n">Gdk</span><span class="p">,</span> <span class="n">GdkPixbuf</span><span class="p">,</span> <span class="n">GObject</span>

<span class="c1"># We will generate a small random network</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">random_graph</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">poisson</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Parameters for the layout update</span>

<span class="n">step</span> <span class="o">=</span> <span class="mf">0.005</span>       <span class="c1"># move step</span>
<span class="n">K</span> <span class="o">=</span> <span class="mf">0.5</span>            <span class="c1"># preferred edge length</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">sfdp_layout</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">)</span>  <span class="c1"># initial layout positions</span>

<span class="c1"># If True, the frames will be dumped to disk as images.</span>
<span class="n">offscreen</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;offscreen&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<span class="n">max_count</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="k">if</span> <span class="n">offscreen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;./frames&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./frames&quot;</span><span class="p">)</span>

<span class="c1"># This creates a GTK+ window with the initial graph layout</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">offscreen</span><span class="p">:</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">GraphWindow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">OffscreenWindow</span><span class="p">()</span>
    <span class="n">win</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">GraphWidget</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="n">win</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

<span class="c1"># list of edges</span>
<span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># This function will be called repeatedly by the GTK+ main loop, and we use it</span>
<span class="c1"># to update the vertex layout and perform the rewiring.</span>
<span class="k">def</span> <span class="nf">update_state</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">count</span>

    <span class="c1"># Perform one iteration of the layout step, starting from the previous positions</span>
    <span class="n">sfdp_layout</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">init_step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="c1"># get a chosen edge, and swap one of its end points for a random vertex,</span>
        <span class="c1"># if it is closer</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">))</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">s1</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">e</span>

        <span class="n">t2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">()))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span><span class="o">.</span><span class="n">a</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">t2</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">norm</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span><span class="o">.</span><span class="n">a</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">s1</span> <span class="o">!=</span> <span class="n">t2</span> <span class="ow">and</span>                      <span class="c1"># no self-loops</span>
            <span class="n">t1</span><span class="o">.</span><span class="n">out_degree</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>           <span class="c1"># no isolated vertices</span>
            <span class="n">t2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s1</span><span class="o">.</span><span class="n">out_neighbors</span><span class="p">()):</span>    <span class="c1"># no parallel edges</span>

            <span class="n">g</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>


    <span class="c1"># The movement of the vertices may cause them to leave the display area. The</span>
    <span class="c1"># following function rescales the layout to fit the window to avoid this.</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">fit_to_window</span><span class="p">(</span><span class="n">ink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># The following will force the re-drawing of the graph, and issue a</span>
    <span class="c1"># re-drawing of the GTK window.</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">regenerate_surface</span><span class="p">()</span>
    <span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">queue_draw</span><span class="p">()</span>

    <span class="c1"># if doing an offscreen animation, dump frame to disk</span>
    <span class="k">if</span> <span class="n">offscreen</span><span class="p">:</span>
        <span class="n">pixbuf</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">get_pixbuf</span><span class="p">()</span>
        <span class="n">pixbuf</span><span class="o">.</span><span class="n">savev</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;./frames/dancing</span><span class="si">%06d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># We need to return True so that the main loop will call this function more</span>
    <span class="c1"># than once.</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="c1"># Bind the function above as an &#39;idle&#39; callback.</span>
<span class="n">cid</span> <span class="o">=</span> <span class="n">GObject</span><span class="o">.</span><span class="n">idle_add</span><span class="p">(</span><span class="n">update_state</span><span class="p">)</span>

<span class="c1"># We will give the user the ability to stop the program by closing the window.</span>
<span class="n">win</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;delete_event&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">)</span>

<span class="c1"># Actually show the window, and start the main loop.</span>
<span class="n">win</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>
<span class="n">Gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>This example works like the SIRS example above, and if we pass the
<code class="docutils literal notranslate"><span class="pre">offscreen</span></code> parameter, the frames will be dumped to disk, otherwise
the animation is displayed inside an <a class="reference internal" href="../../draw.html#graph_tool.draw.interactive_window" title="graph_tool.draw.interactive_window"><code class="xref py py-class docutils literal notranslate"><span class="pre">interactive_window</span></code></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./animation_dancing.py offscreen
</pre></div>
</div>
<p>Also like the previous example, we can encode the animation with the <a class="reference external" href="http://www.webmproject.org">WebM
format</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mencoder mf://frames/dancing*.png -mf <span class="nv">w</span><span class="o">=</span><span class="m">500</span>:h<span class="o">=</span><span class="m">400</span>:type<span class="o">=</span>png -ovc raw -of rawvideo -vf <span class="nv">format</span><span class="o">=</span>i420 -nosound -o dancing.yuy
$ vpxenc dancing.yuy -o dancing.webm -w <span class="m">500</span> -h <span class="m">400</span> --fps<span class="o">=</span><span class="m">100</span>/1 --target-bitrate<span class="o">=</span><span class="m">5000</span> --good --threads<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>The resulting animation can be downloaded <a class="reference download internal" href="../../_downloads/dancing.webm" download=""><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>, or played below if your browser supports WebM.</p>
<div style="text-align:center">
    <video id="sirs" src="../../_downloads/dancing.webm" controls></video>
</div></div>
<div class="section" id="interactive-visualizations">
<h2>Interactive visualizations<a class="headerlink" href="animation.html#interactive-visualizations" title="Permalink to this headline">¶</a></h2>
<p>Here we show an example of interactive visualization where the BFS tree
of the currently selected vertex is highlighted with a different color.</p>
<p>The script which performs the visualization is called
<a class="reference download internal" href="http://graph-tool.skewed.de/static/doc/_downloads/interactive_bst.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">interactive_bst.py</span></code></a> and is shown
below. When called, it will open an interactive window.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This simple example on how to interactive animations using graph-tool. Here we</span>
<span class="c1"># show the BFS tree of length 3 for the currently selected vertex.</span>

<span class="kn">from</span> <span class="nn">graph_tool.all</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1"># We need some Gtk functions</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="k">import</span> <span class="n">Gtk</span><span class="p">,</span> <span class="n">Gdk</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">offscreen</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;offscreen&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>

<span class="c1"># We will use the network of network scientists, and filter out the largest</span>
<span class="c1"># component</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;netscience&quot;</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">GraphView</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vfilt</span><span class="o">=</span><span class="n">label_largest_component</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>  <span class="c1"># layout positions</span>

<span class="n">ecolor</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">new_edge_property</span><span class="p">(</span><span class="s2">&quot;vector&lt;double&gt;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="n">ecolor</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">vcolor</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="s2">&quot;vector&lt;double&gt;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">():</span>
    <span class="n">vcolor</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">win</span> <span class="o">=</span> <span class="n">GraphWindow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
                  <span class="n">edge_color</span><span class="o">=</span><span class="n">ecolor</span><span class="p">,</span>
                  <span class="n">vertex_fill_color</span><span class="o">=</span><span class="n">vcolor</span><span class="p">)</span>

<span class="n">orange</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.807843137254902</span><span class="p">,</span> <span class="mf">0.3607843137254902</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">old_src</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">update_bfs</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">old_src</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">win</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">picked</span>
    <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">PropertyMap</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">()</span> <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="n">v</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="n">old_src</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">old_src</span> <span class="o">=</span> <span class="n">src</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">shortest_distance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pred_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">ecolor</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">():</span>
        <span class="n">vcolor</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">():</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vertex</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">g</span><span class="o">.</span><span class="n">num_vertices</span><span class="p">():</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ecolor</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">orange</span>
                <span class="n">vcolor</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcolor</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">orange</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">regenerate_surface</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">queue_draw</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">offscreen</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">get_window</span><span class="p">()</span>
        <span class="n">pixbuf</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">pixbuf_get_from_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">pixbuf</span><span class="o">.</span><span class="n">savev</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;./frames/bfs</span><span class="si">%06d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">count</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Bind the function above as a montion notify handler</span>
<span class="n">win</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="n">update_bfs</span><span class="p">)</span>

<span class="c1"># We will give the user the ability to stop the program by closing the window.</span>
<span class="n">win</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;delete_event&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">)</span>

<span class="c1"># Actually show the window, and start the main loop.</span>
<span class="n">win</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>
<span class="n">Gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./interactive_bst.py offscreen
</pre></div>
</div>
<p>The above script is interactive, i.e. it expects a reaction from the
user. But for the purpose of this demo, it also saves the frames to a
file, so we can encode the animation with the <a class="reference external" href="http://www.webmproject.org">WebM format</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mencoder mf://frames/bfs*.png -mf <span class="nv">w</span><span class="o">=</span><span class="nv">type</span><span class="o">=</span>png -ovc raw -of rawvideo -vf <span class="nv">format</span><span class="o">=</span>i420,scale<span class="o">=</span><span class="m">500</span>:400 -nosound -o bfs.yuy
$ vpxenc bfs.yuy -o bfs.webm -w <span class="m">500</span> -h <span class="m">400</span> --fps<span class="o">=</span><span class="m">5</span>/1 --target-bitrate<span class="o">=</span><span class="m">5000</span> --good --threads<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>The resulting animation can be downloaded <a class="reference download internal" href="../../_downloads/bfs.webm" download=""><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>, or played below if your browser supports WebM.</p>
<div style="text-align:center">
    <video id="sirs" src="../../_downloads/bfs.webm" controls></video>
</div></div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="animation.html#">Animations with graph-tool</a><ul>
<li><a class="reference internal" href="animation.html#sirs-epidemics">SIRS epidemics</a></li>
<li><a class="reference internal" href="animation.html#dynamic-layout">Dynamic layout</a></li>
<li><a class="reference internal" href="animation.html#interactive-visualizations">Interactive visualizations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../inference/inference.html"
                        title="previous chapter">Inferring modular network structure</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="http://graph-tool.skewed.de/static/doc/modules.html"
                        title="next chapter">Module documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="http://graph-tool.skewed.de/static/doc/_sources/demos/animation/animation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="http://graph-tool.skewed.de/static/doc/modules.html" title="Module documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../inference/inference.html" title="Inferring modular network structure"
             >previous</a> |</li>
    <li><img src="../../../../img/graph-icon.png" alt="logo" style="margin-right: 5px; margin-bottom:-2px;" /><a href="../../../../index.html">Project Homepage</a> &raquo;</li>
    
        <li class="nav-item nav-item-0"><a href="../../index.html">graph-tool 2.27 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Cookbook</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Tiago de Paula Peixoto &lt;tiago@skewed.de&gt;.
      Last updated on Jun 28, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>